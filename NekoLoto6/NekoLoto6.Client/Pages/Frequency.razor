@page "/frequency"
@using NekoLoto6.Client.Models
@using NekoLoto6.Client.Services
@inject LotoCsvParser CsvParser

<PageTitle>NekoLoto6 - å‡ºç¾å›æ•°åˆ†æ</PageTitle>

<h1 class="page-title">ğŸ± ãƒ­ãƒˆ6 å‡ºç¾å›æ•°åˆ†æ</h1>

@if (_loading)
{
    <p class="loading-text">èª­ã¿è¾¼ã¿ä¸­...</p>
}
else if (_error is not null)
{
    <p class="error-text">ã‚¨ãƒ©ãƒ¼: @_error</p>
}
else
{
    <p class="page-subtitle">å…¨ <strong>@_totalDraws</strong> å›ã®æŠ½é¸ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æ</p>

    <div class="card-dark">
        <h2 class="card-dark-title">ç•ªå·åˆ¥ å‡ºç¾å›æ•°ï¼ˆæœ¬æ•°å­—ï¼‰</h2>

        <div class="frequency-chart">
            @for (var num = 1; num <= 43; num++)
            {
                var count = _frequency[num];
                var pct = _maxCount > 0 ? (double)count / _maxCount * 100 : 0;
                <div class="freq-row">
                    <span class="num-badge">@num.ToString("D2")</span>
                    <div class="freq-bar-bg">
                        <div class="freq-bar" style="width: @pct.ToString("F1", System.Globalization.CultureInfo.InvariantCulture)%"></div>
                    </div>
                    <span class="freq-count">@count å›</span>
                </div>
            }
        </div>
    </div>
}

@code {
    private bool _loading = true;
    private string? _error;
    private int _totalDraws;
    private int[] _frequency = new int[44]; // index 1ã€œ43 ã‚’ä½¿ç”¨
    private int _maxCount;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var results = await CsvParser.LoadResultsAsync();
            _totalDraws = results.Count;

            foreach (var result in results)
            {
                foreach (var num in result.MainNumbers)
                {
                    if (num >= 1 && num <= 43)
                        _frequency[num]++;
                }
            }

            _maxCount = _frequency.Skip(1).Max();
        }
        catch (Exception ex)
        {
            _error = ex.Message;
        }
        finally
        {
            _loading = false;
        }
    }
}
